{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///E:/GitHub/CNPM-Final-Project/frontend/client/src/app/pages/contexts/CartContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useCallback, useEffect, useMemo, useState, ReactNode } from \"react\";\r\n\r\ntype CartItem = Record<string, unknown> & {\r\n  _id?: string;\r\n  restaurantId?: string | null;\r\n  quantity?: number;\r\n};\r\n\r\ntype CartContextValue = {\r\n  cartItems: CartItem[];\r\n  addToCart: (food: CartItem, restaurantId?: string | null) => void;\r\n  removeFromCart: (foodId: string) => void;\r\n  updateQuantity: (foodId: string, quantity: number) => void;\r\n  clearCart: () => void;\r\n};\r\n\r\nconst defaultContext: CartContextValue = {\r\n  cartItems: [],\r\n  addToCart: () => undefined,\r\n  removeFromCart: () => undefined,\r\n  updateQuantity: () => undefined,\r\n  clearCart: () => undefined,\r\n};\r\n\r\nexport const CartContext = createContext<CartContextValue>(defaultContext);\r\n\r\nconst getStorage = () => (typeof window === \"undefined\" ? null : window.localStorage);\r\n\r\nconst decodeToken = () => {\r\n  const storage = getStorage();\r\n  if (!storage) return null;\r\n\r\n  const token = storage.getItem(\"token\");\r\n  if (!token) return null;\r\n\r\n  try {\r\n    const payload = JSON.parse(atob(token.split(\".\")[1] ?? \"\"));\r\n    return payload?.id || payload?.userId || payload?._id || null;\r\n  } catch (error) {\r\n    console.error(\"Error decoding token:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst getCartKey = () => {\r\n  const userId = decodeToken();\r\n  return userId ? `cart_${userId}` : \"cart_guest\";\r\n};\r\n\r\nconst normaliseCartItems = (items: CartItem[]): CartItem[] =>\r\n  items.map((item) => ({\r\n    ...item,\r\n    quantity: typeof item.quantity === \"number\" && item.quantity > 0 ? Math.floor(item.quantity) : 1,\r\n  }));\r\n\r\nconst readCart = (): CartItem[] => {\r\n  const storage = getStorage();\r\n  if (!storage) return [];\r\n\r\n  try {\r\n    const saved = storage.getItem(getCartKey());\r\n    if (!saved) return [];\r\n    const parsed = JSON.parse(saved) as CartItem[];\r\n    return Array.isArray(parsed) ? normaliseCartItems(parsed) : [];\r\n  } catch (error) {\r\n    console.error(\"Error loading cart:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst persistCart = (items: CartItem[]) => {\r\n  const storage = getStorage();\r\n  if (!storage) return;\r\n\r\n  try {\r\n    storage.setItem(getCartKey(), JSON.stringify(normaliseCartItems(items)));\r\n  } catch (error) {\r\n    console.error(\"Error saving cart:\", error);\r\n  }\r\n};\r\n\r\ntype CartProviderProps = {\r\n  children: ReactNode;\r\n};\r\n\r\nexport const CartProvider = ({ children }: CartProviderProps) => {\r\n  const [cartItems, setCartItems] = useState<CartItem[]>(() => readCart());\r\n  const [currentUserId, setCurrentUserId] = useState<string | null>(() => decodeToken());\r\n\r\n  useEffect(() => {\r\n    persistCart(cartItems);\r\n  }, [cartItems]);\r\n\r\n  useEffect(() => {\r\n    const handleStorageChange = () => {\r\n      const newUserId = decodeToken();\r\n      if (newUserId !== currentUserId) {\r\n        setCurrentUserId(newUserId);\r\n        setCartItems(readCart());\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"storage\", handleStorageChange);\r\n    return () => window.removeEventListener(\"storage\", handleStorageChange);\r\n  }, [currentUserId]);\r\n\r\n  const addToCart = useCallback<CartContextValue[\"addToCart\"]>((food, restaurantId) => {\r\n    setCartItems((prev) => {\r\n      const identityRestaurant = restaurantId ?? (food.restaurantId as string | null | undefined) ?? null;\r\n      const foodId = typeof food._id === \"string\" && food._id.length > 0 ? food._id : null;\r\n\r\n      const existingIndex = prev.findIndex((item) => {\r\n        if (foodId && item._id === foodId) {\r\n          return true;\r\n        }\r\n        if (!foodId) {\r\n          const sameName =\r\n            typeof item.name === \"string\" &&\r\n            typeof food.name === \"string\" &&\r\n            item.name.trim().toLowerCase() === food.name.trim().toLowerCase();\r\n          const itemRestaurant = item.restaurantId ?? null;\r\n          const foodRestaurant = identityRestaurant ?? (food.restaurantId ?? null);\r\n          return sameName && itemRestaurant === foodRestaurant;\r\n        }\r\n        return false;\r\n      });\r\n\r\n      if (existingIndex !== -1) {\r\n        const updated = [...prev];\r\n        const existing = updated[existingIndex];\r\n        const currentQuantity =\r\n          typeof existing.quantity === \"number\" && existing.quantity > 0 ? Math.floor(existing.quantity) : 1;\r\n\r\n        updated[existingIndex] = {\r\n          ...existing,\r\n          quantity: currentQuantity + 1,\r\n        };\r\n\r\n        return updated;\r\n      }\r\n\r\n      const initialQuantity =\r\n        typeof food.quantity === \"number\" && food.quantity > 0 ? Math.floor(food.quantity) : 1;\r\n\r\n      return [\r\n        ...prev,\r\n        {\r\n          ...food,\r\n          restaurantId: identityRestaurant,\r\n          quantity: initialQuantity,\r\n        },\r\n      ];\r\n    });\r\n  }, []);\r\n\r\n  const removeFromCart = useCallback<CartContextValue[\"removeFromCart\"]>((foodId) => {\r\n    setCartItems((prev) => prev.filter((item) => item._id !== foodId));\r\n  }, []);\r\n\r\n  const updateQuantity = useCallback<CartContextValue[\"updateQuantity\"]>((foodId, quantity) => {\r\n    setCartItems((prev) => {\r\n      if (quantity <= 0) {\r\n        return prev.filter((item) => item._id !== foodId);\r\n      }\r\n      return prev.map((item) =>\r\n        item._id === foodId ? { ...item, quantity: Math.floor(quantity) } : item\r\n      );\r\n    });\r\n  }, []);\r\n\r\n  const clearCart = useCallback(() => {\r\n    const storage = getStorage();\r\n    if (storage) {\r\n      storage.removeItem(getCartKey());\r\n    }\r\n    setCartItems([]);\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({ cartItems, addToCart, removeFromCart, updateQuantity, clearCart }),\r\n    [cartItems, addToCart, removeFromCart, updateQuantity, clearCart]\r\n  );\r\n\r\n  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///E:/GitHub/CNPM-Final-Project/frontend/client/src/app/providers.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport type { ReactNode } from \"react\";\r\nimport { CartProvider } from \"./pages/contexts/CartContext\";\r\n\r\ntype ProvidersProps = {\r\n  children: ReactNode;\r\n};\r\n\r\nconst Providers = ({ children }: ProvidersProps) => {\r\n  return <CartProvider>{children}</CartProvider>;\r\n};\r\n\r\nexport default Providers;\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AASA,MAAM,YAAY,CAAC,EAAE,QAAQ,EAAkB;IAC7C,qBAAO,8OAAC,+JAAY;kBAAE;;;;;;AACxB;uCAEe","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///E:/GitHub/CNPM-Final-Project/frontend/client/node_modules/next/src/server/route-modules/app-page/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;KAElC;IACL,IAAIF,QAAQC,GAAG,CAACK,yBAAyB,EAAE;;SAcpC;QACL,IAAIN,QAAQC,GAAG,CAACM,QAAQ,KAAK,WAAe;YAC1C,IAAIP,QAAQC,GAAG,CAACO,SAAS,eAAE;gBACzBL,OAAOC,OAAO,GAAGC,QAAQ;YAC3B,OAAO;;QAGT,OAAO;;IAOT;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///E:/GitHub/CNPM-Final-Project/frontend/client/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///E:/GitHub/CNPM-Final-Project/frontend/client/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n"],"names":["module","exports","require","vendored","React"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,KAAK","ignoreList":[0],"debugId":null}}]
}