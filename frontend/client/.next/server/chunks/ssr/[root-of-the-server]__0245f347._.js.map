{"version":3,"sources":["turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/module.compiled.js","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","turbopack:///[project]/src/app/pages/contexts/CartContext.tsx","turbopack:///[project]/src/app/providers.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\r\n\r\nimport { createContext, useCallback, useEffect, useMemo, useState, ReactNode } from \"react\";\r\n\r\ntype CartItem = Record<string, unknown> & {\r\n  _id?: string;\r\n  restaurantId?: string | null;\r\n  quantity?: number;\r\n};\r\n\r\ntype CartContextValue = {\r\n  cartItems: CartItem[];\r\n  addToCart: (food: CartItem, restaurantId?: string | null) => void;\r\n  removeFromCart: (foodId: string) => void;\r\n  updateQuantity: (foodId: string, quantity: number) => void;\r\n  clearCart: () => void;\r\n};\r\n\r\nconst defaultContext: CartContextValue = {\r\n  cartItems: [],\r\n  addToCart: () => undefined,\r\n  removeFromCart: () => undefined,\r\n  updateQuantity: () => undefined,\r\n  clearCart: () => undefined,\r\n};\r\n\r\nexport const CartContext = createContext<CartContextValue>(defaultContext);\r\n\r\nconst getStorage = () => (typeof window === \"undefined\" ? null : window.localStorage);\r\n\r\nconst decodeToken = () => {\r\n  const storage = getStorage();\r\n  if (!storage) return null;\r\n\r\n  const token = storage.getItem(\"token\");\r\n  if (!token) return null;\r\n\r\n  try {\r\n    const payload = JSON.parse(atob(token.split(\".\")[1] ?? \"\"));\r\n    return payload?.id || payload?.userId || payload?._id || null;\r\n  } catch (error) {\r\n    console.error(\"Error decoding token:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\nconst getCartKey = () => {\r\n  const userId = decodeToken();\r\n  return userId ? `cart_${userId}` : \"cart_guest\";\r\n};\r\n\r\nconst normaliseCartItems = (items: CartItem[]): CartItem[] =>\r\n  items.map((item) => ({\r\n    ...item,\r\n    quantity: typeof item.quantity === \"number\" && item.quantity > 0 ? Math.floor(item.quantity) : 1,\r\n  }));\r\n\r\nconst readCart = (): CartItem[] => {\r\n  const storage = getStorage();\r\n  if (!storage) return [];\r\n\r\n  try {\r\n    const saved = storage.getItem(getCartKey());\r\n    if (!saved) return [];\r\n    const parsed = JSON.parse(saved) as CartItem[];\r\n    return Array.isArray(parsed) ? normaliseCartItems(parsed) : [];\r\n  } catch (error) {\r\n    console.error(\"Error loading cart:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst persistCart = (items: CartItem[]) => {\r\n  const storage = getStorage();\r\n  if (!storage) return;\r\n\r\n  try {\r\n    storage.setItem(getCartKey(), JSON.stringify(normaliseCartItems(items)));\r\n  } catch (error) {\r\n    console.error(\"Error saving cart:\", error);\r\n  }\r\n};\r\n\r\ntype CartProviderProps = {\r\n  children: ReactNode;\r\n};\r\n\r\nexport const CartProvider = ({ children }: CartProviderProps) => {\r\n  const [cartItems, setCartItems] = useState<CartItem[]>(() => readCart());\r\n  const [currentUserId, setCurrentUserId] = useState<string | null>(() => decodeToken());\r\n\r\n  useEffect(() => {\r\n    persistCart(cartItems);\r\n  }, [cartItems]);\r\n\r\n  useEffect(() => {\r\n    const handleStorageChange = () => {\r\n      const newUserId = decodeToken();\r\n      if (newUserId !== currentUserId) {\r\n        setCurrentUserId(newUserId);\r\n        setCartItems(readCart());\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"storage\", handleStorageChange);\r\n    return () => window.removeEventListener(\"storage\", handleStorageChange);\r\n  }, [currentUserId]);\r\n\r\n  const addToCart = useCallback<CartContextValue[\"addToCart\"]>((food, restaurantId) => {\r\n    setCartItems((prev) => {\r\n      const identityRestaurant = restaurantId ?? (food.restaurantId as string | null | undefined) ?? null;\r\n      const foodId = typeof food._id === \"string\" && food._id.length > 0 ? food._id : null;\r\n\r\n      const existingIndex = prev.findIndex((item) => {\r\n        if (foodId && item._id === foodId) {\r\n          return true;\r\n        }\r\n        if (!foodId) {\r\n          const sameName =\r\n            typeof item.name === \"string\" &&\r\n            typeof food.name === \"string\" &&\r\n            item.name.trim().toLowerCase() === food.name.trim().toLowerCase();\r\n          const itemRestaurant = item.restaurantId ?? null;\r\n          const foodRestaurant = identityRestaurant ?? (food.restaurantId ?? null);\r\n          return sameName && itemRestaurant === foodRestaurant;\r\n        }\r\n        return false;\r\n      });\r\n\r\n      if (existingIndex !== -1) {\r\n        const updated = [...prev];\r\n        const existing = updated[existingIndex];\r\n        const currentQuantity =\r\n          typeof existing.quantity === \"number\" && existing.quantity > 0 ? Math.floor(existing.quantity) : 1;\r\n\r\n        updated[existingIndex] = {\r\n          ...existing,\r\n          quantity: currentQuantity + 1,\r\n        };\r\n\r\n        return updated;\r\n      }\r\n\r\n      const initialQuantity =\r\n        typeof food.quantity === \"number\" && food.quantity > 0 ? Math.floor(food.quantity) : 1;\r\n\r\n      return [\r\n        ...prev,\r\n        {\r\n          ...food,\r\n          restaurantId: identityRestaurant,\r\n          quantity: initialQuantity,\r\n        },\r\n      ];\r\n    });\r\n  }, []);\r\n\r\n  const removeFromCart = useCallback<CartContextValue[\"removeFromCart\"]>((foodId) => {\r\n    setCartItems((prev) => prev.filter((item) => item._id !== foodId));\r\n  }, []);\r\n\r\n  const updateQuantity = useCallback<CartContextValue[\"updateQuantity\"]>((foodId, quantity) => {\r\n    setCartItems((prev) => {\r\n      if (quantity <= 0) {\r\n        return prev.filter((item) => item._id !== foodId);\r\n      }\r\n      return prev.map((item) =>\r\n        item._id === foodId ? { ...item, quantity: Math.floor(quantity) } : item\r\n      );\r\n    });\r\n  }, []);\r\n\r\n  const clearCart = useCallback(() => {\r\n    const storage = getStorage();\r\n    if (storage) {\r\n      storage.removeItem(getCartKey());\r\n    }\r\n    setCartItems([]);\r\n  }, []);\r\n\r\n  const value = useMemo(\r\n    () => ({ cartItems, addToCart, removeFromCart, updateQuantity, clearCart }),\r\n    [cartItems, addToCart, removeFromCart, updateQuantity, clearCart]\r\n  );\r\n\r\n  return <CartContext.Provider value={value}>{children}</CartContext.Provider>;\r\n};\r\n","\"use client\";\r\n\r\nimport type { ReactNode } from \"react\";\r\nimport { CartProvider } from \"./pages/contexts/CartContext\";\r\n\r\ntype ProvidersProps = {\r\n  children: ReactNode;\r\n};\r\n\r\nconst Providers = ({ children }: ProvidersProps) => {\r\n  return <CartProvider>{children}</CartProvider>;\r\n};\r\n\r\nexport default Providers;\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}