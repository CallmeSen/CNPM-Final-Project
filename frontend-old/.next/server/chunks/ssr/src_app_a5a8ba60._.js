module.exports=[74819,a=>{a.v({backLink:"checkout-module__d81G3q__backLink",breadcrumbCurrent:"checkout-module__d81G3q__breadcrumbCurrent",breadcrumbLink:"checkout-module__d81G3q__breadcrumbLink",breadcrumbSeparator:"checkout-module__d81G3q__breadcrumbSeparator",breadcrumbs:"checkout-module__d81G3q__breadcrumbs",cardBrand:"checkout-module__d81G3q__cardBrand",cardDetailsGrid:"checkout-module__d81G3q__cardDetailsGrid",cardElement:"checkout-module__d81G3q__cardElement",cardElementContainer:"checkout-module__d81G3q__cardElementContainer",cardFieldWrapper:"checkout-module__d81G3q__cardFieldWrapper",cardLabel:"checkout-module__d81G3q__cardLabel",cashActions:"checkout-module__d81G3q__cashActions",cashDescription:"checkout-module__d81G3q__cashDescription",cashSection:"checkout-module__d81G3q__cashSection",checkoutContainer:"checkout-module__d81G3q__checkoutContainer",checkoutFallback:"checkout-module__d81G3q__checkoutFallback",checkoutFooter:"checkout-module__d81G3q__checkoutFooter",checkoutGrid:"checkout-module__d81G3q__checkoutGrid",errorMessage:"checkout-module__d81G3q__errorMessage",methodDescription:"checkout-module__d81G3q__methodDescription",methodEmoji:"checkout-module__d81G3q__methodEmoji",methodNotice:"checkout-module__d81G3q__methodNotice",methodOption:"checkout-module__d81G3q__methodOption",methodOptions:"checkout-module__d81G3q__methodOptions",methodSection:"checkout-module__d81G3q__methodSection",methodTitle:"checkout-module__d81G3q__methodTitle",paymentForm:"checkout-module__d81G3q__paymentForm",paymentHeader:"checkout-module__d81G3q__paymentHeader",paymentIcon:"checkout-module__d81G3q__paymentIcon",paymentSection:"checkout-module__d81G3q__paymentSection",paymentSubtitle:"checkout-module__d81G3q__paymentSubtitle",paymentTitle:"checkout-module__d81G3q__paymentTitle",secondaryButton:"checkout-module__d81G3q__secondaryButton",submitButton:"checkout-module__d81G3q__submitButton",successMessage:"checkout-module__d81G3q__successMessage",summaryAddress:"checkout-module__d81G3q__summaryAddress",summaryAddressLabel:"checkout-module__d81G3q__summaryAddressLabel",summaryFooter:"checkout-module__d81G3q__summaryFooter",summaryHeader:"checkout-module__d81G3q__summaryHeader",summaryIcon:"checkout-module__d81G3q__summaryIcon",summaryItem:"checkout-module__d81G3q__summaryItem",summaryItemBody:"checkout-module__d81G3q__summaryItemBody",summaryItemName:"checkout-module__d81G3q__summaryItemName",summaryItemPrice:"checkout-module__d81G3q__summaryItemPrice",summaryItemQuantity:"checkout-module__d81G3q__summaryItemQuantity",summaryItems:"checkout-module__d81G3q__summaryItems",summarySection:"checkout-module__d81G3q__summarySection",summarySubtitle:"checkout-module__d81G3q__summarySubtitle",summaryTitle:"checkout-module__d81G3q__summaryTitle",supportBox:"checkout-module__d81G3q__supportBox"})},62394,a=>{"use strict";a.s(["default",()=>_],62394);var b,c=a.i(87924),d=a.i(72131),e=a.i(41212);function f(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function g(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?f(Object(c),!0).forEach(function(b){i(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):f(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function h(a){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function i(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function j(a,b){if(null==a)return{};var c,d,e=function(a,b){if(null==a)return{};var c,d,e={},f=Object.keys(a);for(d=0;d<f.length;d++)c=f[d],b.indexOf(c)>=0||(e[c]=a[c]);return e}(a,b);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(a);for(d=0;d<f.length;d++)c=f[d],!(b.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(a,c)&&(e[c]=a[c])}return e}function k(a,b){return function(a){if(Array.isArray(a))return a}(a)||function(a,b){var c,d,e=a&&("undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"]);if(null!=e){var f=[],g=!0,h=!1;try{for(e=e.call(a);!(g=(c=e.next()).done)&&(f.push(c.value),!b||f.length!==b);g=!0);}catch(a){h=!0,d=a}finally{try{g||null==e.return||e.return()}finally{if(h)throw d}}return f}}(a,b)||function(a,b){if(a){if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}}(a,b)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var m=function(a,b,c){var e=!!c,f=d.default.useRef(c);d.default.useEffect(function(){f.current=c},[c]),d.default.useEffect(function(){if(!e||!a)return function(){};var c=function(){f.current&&f.current.apply(f,arguments)};return a.on(b,c),function(){a.off(b,c)}},[e,b,a,f])},n=function(a){var b=d.default.useRef(a);return d.default.useEffect(function(){b.current=a},[a]),b.current},o=function(a){return null!==a&&"object"===h(a)},p="[object Object]",q=function a(b,c){if(!o(b)||!o(c))return b===c;var d=Array.isArray(b);if(d!==Array.isArray(c))return!1;var e=Object.prototype.toString.call(b)===p;if(e!==(Object.prototype.toString.call(c)===p))return!1;if(!e&&!d)return b===c;var f=Object.keys(b),g=Object.keys(c);if(f.length!==g.length)return!1;for(var h={},i=0;i<f.length;i+=1)h[f[i]]=!0;for(var j=0;j<g.length;j+=1)h[g[j]]=!0;var k=Object.keys(h);return k.length===f.length&&k.every(function(d){return a(b[d],c[d])})},r=function(a,b,c){return o(a)?Object.keys(a).reduce(function(d,e){var f=!o(b)||!q(a[e],b[e]);return c.includes(e)?(f&&console.warn("Unsupported prop change: options.".concat(e," is not a mutable property.")),d):f?g(g({},d||{}),{},i({},e,a[e])):d},null):null},s="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",t=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;if(null===a||o(a)&&"function"==typeof a.elements&&"function"==typeof a.createToken&&"function"==typeof a.createPaymentMethod&&"function"==typeof a.confirmCardPayment)return a;throw Error(b)},u=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;if(o(a)&&"function"==typeof a.then)return{tag:"async",stripePromise:Promise.resolve(a).then(function(a){return t(a,b)})};var c=t(a,b);return null===c?{tag:"empty"}:{tag:"sync",stripe:c}},v=function(a){a&&a._registerWrapper&&a.registerAppInfo&&(a._registerWrapper({name:"react-stripe-js",version:"3.10.0"}),a.registerAppInfo({name:"react-stripe-js",version:"3.10.0",url:"https://stripe.com/docs/stripe-js/react"}))},w=d.default.createContext(null);w.displayName="ElementsContext";var x=function(a,b){if(!a)throw Error("Could not find Elements context; You need to wrap the part of your app that ".concat(b," in an <Elements> provider."));return a},y=function(a){var b=a.stripe,c=a.options,e=a.children,f=d.default.useMemo(function(){return u(b)},[b]),g=k(d.default.useState(function(){return{stripe:"sync"===f.tag?f.stripe:null,elements:"sync"===f.tag?f.stripe.elements(c):null}}),2),h=g[0],i=g[1];d.default.useEffect(function(){var a=!0,b=function(a){i(function(b){return b.stripe?b:{stripe:a,elements:a.elements(c)}})};return"async"!==f.tag||h.stripe?"sync"!==f.tag||h.stripe||b(f.stripe):f.stripePromise.then(function(c){c&&a&&b(c)}),function(){a=!1}},[f,h,c]);var j=n(b);d.default.useEffect(function(){null!==j&&j!==b&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[j,b]);var l=n(c);return d.default.useEffect(function(){if(h.elements){var a=r(c,l,["clientSecret","fonts"]);a&&h.elements.update(a)}},[c,l,h.elements]),d.default.useEffect(function(){v(h.stripe)},[h.stripe]),d.default.createElement(w.Provider,{value:h},e)};y.propTypes={stripe:e.default.any,options:e.default.object};e.default.func.isRequired;var z=d.default.createContext(null);z.displayName="CheckoutSdkContext";var A=function(a,b){if(!a)throw Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(b," in an <CheckoutProvider> provider."));return a};d.default.createContext(null).displayName="CheckoutContext";e.default.any,e.default.shape({fetchClientSecret:e.default.func.isRequired,elementsOptions:e.default.object}).isRequired;var B=function(a){var b=d.default.useContext(z),c=d.default.useContext(w);if(b&&c)throw Error("You cannot wrap the part of your app that ".concat(a," in both <CheckoutProvider> and <Elements> providers."));return b?A(b,a):x(c,a)},C=["mode"],D=function(a,b){var c="".concat(a.charAt(0).toUpperCase()+a.slice(1),"Element"),f=b?function(a){B("mounts <".concat(c,">"));var b=a.id,e=a.className;return d.default.createElement("div",{id:b,className:e})}:function(b){var e,f=b.id,g=b.className,h=b.options,i=void 0===h?{}:h,l=b.onBlur,o=b.onFocus,p=b.onReady,q=b.onChange,s=b.onEscape,t=b.onClick,u=b.onLoadError,v=b.onLoaderStart,w=b.onNetworksChange,x=b.onConfirm,y=b.onCancel,z=b.onShippingAddressChange,A=b.onShippingRateChange,D=b.onSavedPaymentMethodRemove,E=b.onSavedPaymentMethodUpdate,F=B("mounts <".concat(c,">")),G="elements"in F?F.elements:null,H="checkoutSdk"in F?F.checkoutSdk:null,I=k(d.default.useState(null),2),J=I[0],K=I[1],L=d.default.useRef(null),M=d.default.useRef(null);m(J,"blur",l),m(J,"focus",o),m(J,"escape",s),m(J,"click",t),m(J,"loaderror",u),m(J,"loaderstart",v),m(J,"networkschange",w),m(J,"confirm",x),m(J,"cancel",y),m(J,"shippingaddresschange",z),m(J,"shippingratechange",A),m(J,"savedpaymentmethodremove",D),m(J,"savedpaymentmethodupdate",E),m(J,"change",q),p&&(e="expressCheckout"===a?p:function(){p(J)}),m(J,"ready",e),d.default.useLayoutEffect(function(){if(null===L.current&&null!==M.current&&(G||H)){var b=null;if(H)switch(a){case"payment":b=H.createPaymentElement(i);break;case"address":if("mode"in i){var d=i.mode,e=j(i,C);if("shipping"===d)b=H.createShippingAddressElement(e);else if("billing"===d)b=H.createBillingAddressElement(e);else throw Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":b=H.createExpressCheckoutElement(i);break;case"currencySelector":b=H.createCurrencySelectorElement();break;case"taxId":b=H.createTaxIdElement(i);break;default:throw Error("Invalid Element type ".concat(c,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else G&&(b=G.create(a,i));L.current=b,K(b),b&&b.mount(M.current)}},[G,H,i]);var N=n(i);return d.default.useEffect(function(){if(L.current){var a=r(i,N,["paymentRequest"]);a&&"update"in L.current&&L.current.update(a)}},[i,N]),d.default.useLayoutEffect(function(){return function(){if(L.current&&"function"==typeof L.current.destroy)try{L.current.destroy(),L.current=null}catch(a){}}},[]),d.default.createElement("div",{id:f,className:g,ref:M})};return f.propTypes={id:e.default.string,className:e.default.string,onChange:e.default.func,onBlur:e.default.func,onFocus:e.default.func,onReady:e.default.func,onEscape:e.default.func,onClick:e.default.func,onLoadError:e.default.func,onLoaderStart:e.default.func,onNetworksChange:e.default.func,onConfirm:e.default.func,onCancel:e.default.func,onShippingAddressChange:e.default.func,onShippingRateChange:e.default.func,onSavedPaymentMethodRemove:e.default.func,onSavedPaymentMethodUpdate:e.default.func,options:e.default.object},f.displayName=c,f.__elementType=a,f},E=d.default.createContext(null);E.displayName="EmbeddedCheckoutProviderContext";D("auBankAccount",!0),D("card",!0);var F=D("cardNumber",!0),G=D("cardExpiry",!0),H=D("cardCvc",!0);D("fpxBank",!0),D("iban",!0),D("idealBank",!0),D("p24Bank",!0),D("epsBank",!0),D("payment",!0),D("expressCheckout",!0),D("currencySelector",!0),D("paymentRequestButton",!0),D("linkAuthentication",!0),D("address",!0),D("shippingAddress",!0),D("paymentMethodMessaging",!0),D("affirmMessage",!0),D("afterpayClearpayMessage",!0),D("taxId",!0);var I="acacia";"".concat("https://js.stripe.com","/").concat(I,"/stripe.js");var J=function(a,b){a&&a._registerWrapper&&a._registerWrapper({name:"stripe-js",version:"6.1.0",startTime:b})},K=null,L=function(a,b,c){if(null===a)return null;var d,e=b[0].match(/^pk_test/),f=3===(d=a.version)?"v3":d;e&&f!==I&&console.warn("Stripe.js@".concat(f," was loaded on the page, but @stripe/stripe-js@").concat("6.1.0"," expected Stripe.js@").concat(I,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var g=a.apply(void 0,b);return J(g,c),g},M=!1,N=function(){return b?b:b=(null!==K?K:(K=new Promise(function(a,b){a(null)})).catch(function(a){return K=null,Promise.reject(a)})).catch(function(a){return b=null,Promise.reject(a)})};Promise.resolve().then(function(){return N()}).catch(function(a){M||console.warn(a)});var O=a.i(83490),P=a.i(50944),Q=a.i(38246);a.i(50407);var R=a.i(74819);let S=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];M=!0;var d=Date.now();return N().then(function(a){return L(a,b,d)})}("pk_test_51S6DRtPb5k3ojf4pY5t8beaMLClnsc0CwnowMxbCJW6henbjlN8uju2CVextQkMuncqKToNSZO18YdKXuOMTwQYl00Z6BWamZc"),T="http://localhost:5005",U=a=>a.toLocaleString("en-US",{style:"currency",currency:"USD"}),V=(a,b)=>{if(!a)return{error:"No order data available."};let c=(a=>{let b=(a=>{if(!a)return null;try{let b=a.split(".");if(b.length<2)return null;let c=b[1]??"";for(c=c.replace(/-/g,"+").replace(/_/g,"/");c.length%4!=0;)c+="=";let d=atob(c);return JSON.parse(d)}catch(a){return console.error("Failed to decode auth token",a),null}})(a);if(!b)return"";let c=b.id??b._id??b.sub??b.userId??b.user_id??b.userID;return c?String(c).trim():""})(b);if(c||(c="string"==typeof a?.customerId?a.customerId.trim():""),!c)return{error:"We could not validate your account for this order. Please sign in again and retry."};let d=String(a.restaurantId??"").trim();if(!d)return{error:"We could not determine the restaurant for this order. Please return to your cart and try again."};let e=String(a.deliveryAddress??"").trim();if(!e)return{error:"Your delivery address is missing. Please update it in your cart and try again."};let f=a.items?.reduce((a,b)=>{let c=String(b.foodId??"").trim();if(!c)return a;let d=Number(b.quantity??0),e=Number.isFinite(d)?Math.max(1,Math.floor(d)):0,f=Number(b.price??0),g=Number.isFinite(f)?Math.round(100*f)/100:0;return e<=0||g<=0||a.push({foodId:c,quantity:e,price:g}),a},[])??[];if(0===f.length)return{error:"We could not find any items in your order. Please add items to your cart and try again."};let g=f.reduce((a,b)=>a+b.quantity*b.price,0);return{payload:{customerId:c,restaurantId:d,items:f,deliveryAddress:e,totalPrice:g}}},W=({stripeEnabled:a})=>{let b=(0,P.useRouter)(),e=(()=>{let a=(0,P.useSearchParams)().get("order");if(a)try{let b=JSON.parse(decodeURIComponent(a));if(b&&"object"==typeof b)return b}catch(a){console.error("Failed to parse order payload from URL",a)}return null})(),[f,g]=(0,d.useState)(null),[h,i]=(0,d.useState)(null),j=(0,d.useMemo)(()=>{let a=e?.totalPrice??0;return Number.isFinite(a)?a:0},[e]),k=(0,d.useMemo)(()=>{let a=h?.firstName??"Customer",b=h?.lastName??"",c=h?.email??"customer@example.com",d=h?.phone??"";return{firstName:a,lastName:b,fullName:[a,b].filter(Boolean).join(" "),email:c,phone:d}},[h]);return((0,d.useEffect)(()=>{},[]),e&&e.items&&0!==e.items.length)?(0,c.jsxs)("div",{className:R.default.checkoutContainer,children:[(0,c.jsxs)("nav",{className:R.default.breadcrumbs,children:[(0,c.jsx)(Q.default,{href:"/",className:R.default.breadcrumbLink,children:"Home"}),(0,c.jsx)("span",{className:R.default.breadcrumbSeparator,children:"/"}),(0,c.jsx)(Q.default,{href:"/customer/cart",className:R.default.breadcrumbLink,children:"Cart"}),(0,c.jsx)("span",{className:R.default.breadcrumbSeparator,children:"/"}),(0,c.jsx)("span",{className:R.default.breadcrumbCurrent,children:"Checkout"})]}),(0,c.jsxs)("div",{className:R.default.checkoutGrid,children:[(0,c.jsx)(X,{order:e,totalPrice:j,billingDetails:k}),null===f&&(0,c.jsx)(Y,{stripeEnabled:a,onSelect:a=>{g(a)}}),"cash"===f&&(0,c.jsx)(Z,{order:e,totalPrice:j,onBack:()=>g(null)}),"stripe"===f&&a&&(0,c.jsx)($,{order:e,totalPrice:j,billingDetails:k,onBack:()=>g(null)}),"stripe"===f&&!a&&(0,c.jsxs)("section",{className:R.default.methodSection,children:[(0,c.jsx)("p",{className:R.default.methodNotice,children:"Card payments are unavailable right now. Please select cash on delivery."}),(0,c.jsx)("button",{type:"button",className:R.default.secondaryButton,onClick:()=>g(null),children:"Go back"})]})]}),(0,c.jsxs)("footer",{className:R.default.checkoutFooter,children:[(0,c.jsx)("p",{children:"Secure checkout with flexible payment options."}),(0,c.jsxs)("p",{children:["Need to make changes? ",(0,c.jsx)("button",{onClick:()=>b.back(),children:"Go back"})]})]})]}):(0,c.jsxs)("div",{className:R.default.checkoutFallback,children:[(0,c.jsx)("h1",{children:"No Order Found"}),(0,c.jsx)("p",{children:"Please add items to your cart before checking out."}),(0,c.jsx)(Q.default,{href:"/",className:R.default.backLink,children:"Browse restaurants"})]})},X=({order:a,totalPrice:b,billingDetails:d})=>(0,c.jsxs)("section",{className:R.default.summarySection,children:[(0,c.jsxs)("header",{className:R.default.summaryHeader,children:[(0,c.jsx)("div",{className:R.default.summaryIcon,children:"ðŸ§¾"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:R.default.summaryTitle,children:"Order Summary"}),d.fullName&&(0,c.jsx)("p",{className:R.default.summarySubtitle,children:d.fullName})]})]}),(0,c.jsx)("div",{className:R.default.summaryItems,children:a?.items?.map((a,b)=>(0,c.jsxs)("div",{className:R.default.summaryItem,children:[(0,c.jsxs)("div",{className:R.default.summaryItemBody,children:[(0,c.jsx)("span",{className:R.default.summaryItemName,children:a.name??"Food Item"}),(0,c.jsxs)("span",{className:R.default.summaryItemQuantity,children:["Qty: ",a.quantity??1]})]}),(0,c.jsx)("span",{className:R.default.summaryItemPrice,children:U(a.price??0)})]},`${a.foodId??`item-${b}`}`))}),(0,c.jsxs)("div",{className:R.default.summaryFooter,children:[(0,c.jsx)("span",{children:"Total"}),(0,c.jsx)("strong",{children:U(b)})]}),a?.deliveryAddress&&(0,c.jsxs)("div",{className:R.default.summaryAddress,children:[(0,c.jsx)("span",{className:R.default.summaryAddressLabel,children:"Delivery Address"}),(0,c.jsx)("p",{children:a.deliveryAddress})]})]}),Y=({stripeEnabled:a,onSelect:b})=>(0,c.jsxs)("section",{className:R.default.methodSection,children:[(0,c.jsxs)("header",{className:R.default.paymentHeader,children:[(0,c.jsx)("div",{className:R.default.paymentIcon,children:"ðŸ’°"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:R.default.paymentTitle,children:"Choose Payment Method"}),(0,c.jsx)("p",{className:R.default.paymentSubtitle,children:"Select how you would like to pay for this order"})]})]}),(0,c.jsxs)("div",{className:R.default.methodOptions,children:[(0,c.jsxs)("button",{type:"button",className:R.default.methodOption,onClick:()=>b("cash"),children:[(0,c.jsx)("span",{className:R.default.methodEmoji,children:"ðŸ’µ"}),(0,c.jsx)("span",{className:R.default.methodTitle,children:"Cash on Delivery"}),(0,c.jsx)("span",{className:R.default.methodDescription,children:"Pay when your food arrives"})]}),(0,c.jsxs)("button",{type:"button",className:R.default.methodOption,onClick:()=>b("stripe"),disabled:!a,children:[(0,c.jsx)("span",{className:R.default.methodEmoji,children:"ðŸ’³"}),(0,c.jsx)("span",{className:R.default.methodTitle,children:"Pay with Card"}),(0,c.jsx)("span",{className:R.default.methodDescription,children:a?"Secure online payment via Stripe":"Card payments unavailable"})]})]}),!a&&(0,c.jsx)("div",{className:R.default.methodNotice,children:"Card payments are currently unavailable. Please choose cash on delivery."})]}),Z=({order:a,totalPrice:b,onBack:e})=>{let f=(0,P.useRouter)(),[g,h]=(0,d.useState)(!1),[i,j]=(0,d.useState)(""),[k,l]=(0,d.useState)(""),m=async()=>{if(!a)return void j("No order data available.");h(!0),j(""),l("");let{payload:b,error:c}=V(a,null);if(!b){j(c??"Unable to prepare your order. Please try again."),h(!1);return}try{await O.default.post(`${T}/api/orders`,b,{headers:{Authorization:"","Content-Type":"application/json"}}),l("Order placed successfully with cash payment on delivery."),setTimeout(()=>{f.push("/customer/order-history")},2e3)}catch(a){O.default.isAxiosError(a)?console.error("Failed to place cash order",{status:a.response?.status,data:a.response?.data,message:a.message,payload:b}):console.error("Failed to place cash order",a),j("Unable to place order. Please try again.")}h(!1)};return(0,c.jsxs)("section",{className:R.default.cashSection,children:[(0,c.jsxs)("header",{className:R.default.paymentHeader,children:[(0,c.jsx)("div",{className:R.default.paymentIcon,children:"ðŸ§¾"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:R.default.paymentTitle,children:"Cash on Delivery"}),(0,c.jsx)("p",{className:R.default.paymentSubtitle,children:"Confirm your order and pay when it arrives"})]})]}),(0,c.jsxs)("p",{className:R.default.cashDescription,children:["A confirmation will be sent to your email. Please prepare exact change totaling"," ",U(b),"."]}),(0,c.jsxs)("div",{className:R.default.cashActions,children:[(0,c.jsx)("button",{type:"button",className:R.default.secondaryButton,onClick:e,disabled:g,children:"Choose another method"}),(0,c.jsx)("button",{type:"button",className:R.default.submitButton,onClick:m,disabled:g,children:g?"Placing orderâ€¦":"Confirm Cash Order"})]}),i&&(0,c.jsx)("div",{className:R.default.errorMessage,children:i}),k&&(0,c.jsx)("div",{className:R.default.successMessage,children:k})]})},$=({order:a,totalPrice:b,billingDetails:e,onBack:f})=>{var g;let h=B("calls useStripe()").stripe,i=(g="calls useElements()",x(d.default.useContext(w),g)).elements,j=(0,P.useRouter)(),[k,l]=(0,d.useState)(""),[m,n]=(0,d.useState)(!1),[o,p]=(0,d.useState)(""),[q,r]=(0,d.useState)(""),[s,t]=(0,d.useState)(""),[u,v]=(0,d.useState)(!1),y=(0,d.useRef)(!1),z=(0,d.useMemo)(()=>Math.round(100*b),[b]),A=(0,d.useMemo)(()=>{let b="";return b||(b="string"==typeof a?.customerId?a.customerId.trim():""),b||(b=e.fullName||"guest"),{orderId:`ORDER-${Date.now()}`,userId:b,amount:z/100,currency:"usd",firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone??"+1234567890"}},[z,e,a?.customerId]);(0,d.useEffect)(()=>{(async()=>{if(a&&a.items&&0!==a.items.length&&!y.current&&!k){y.current=!0;try{let a=await O.default.post("http://localhost:5004/api/payment/process",A);if(a.data?.paymentStatus==="Paid"||a.data?.disablePayment){r("This order has already been paid."),v(!0);return}a.data?.clientSecret?l(a.data.clientSecret):p("Unable to initialise payment. Please try again later.")}catch(a){console.error("Failed to create payment intent",a),p("Unable to initialise payment. Please try again later.")}}})()},[k,a,A]);let C=async b=>{if(b.preventDefault(),p(""),r(""),!h||!i||!k)return void p("Payment is not ready yet. Please wait a moment and try again.");n(!0);try{let b=i.getElement(F);if(!b){p("Unable to access card details. Please reload and try again."),n(!1);return}let{error:c,paymentMethod:d}=await h.createPaymentMethod({type:"card",card:b,billing_details:{name:e.fullName,email:e.email}});if(c){p(c.message??"Unable to process payment method."),n(!1);return}let{error:f,paymentIntent:g}=await h.confirmCardPayment(k,{payment_method:d?.id});if(f){p(f.message??"Payment confirmation failed. Please try again."),n(!1);return}if(g?.status==="succeeded"){r("Payment successful! Creating your order..."),v(!0);let{payload:b,error:c}=V(a,null);if(!b){v(!1),n(!1),p(c??"Payment succeeded but we could not prepare your order. Please try again.");return}try{await O.default.post(`${T}/api/orders`,b,{headers:{Authorization:"","Content-Type":"application/json"}}),r("Payment successful! Your order has been placed."),setTimeout(()=>{j.push("/customer/order-history")},2e3)}catch(a){O.default.isAxiosError(a)?console.error("Failed to create order",{status:a.response?.status,data:a.response?.data,message:a.message,payload:b}):console.error("Failed to create order",a),p(`Payment succeeded but we could not create your order. Please contact support with payment id ${g.id}.`)}}else p("Payment did not complete. Please try again.")}catch(a){console.error("Unexpected checkout error",a),p("An unexpected error occurred. Please try again.")}n(!1)};return(0,c.jsxs)("section",{className:R.default.paymentSection,children:[(0,c.jsxs)("header",{className:R.default.paymentHeader,children:[(0,c.jsx)("div",{className:R.default.paymentIcon,children:"ðŸ’³"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:R.default.paymentTitle,children:"Card Details"}),(0,c.jsx)("p",{className:R.default.paymentSubtitle,children:"Secure payments powered by Stripe"})]})]}),(0,c.jsxs)("form",{onSubmit:C,className:R.default.paymentForm,children:[(0,c.jsxs)("div",{className:R.default.cardFieldWrapper,children:[(0,c.jsx)("label",{htmlFor:"card-number-element",className:R.default.cardLabel,children:"Card number"}),(0,c.jsxs)("div",{className:R.default.cardElementContainer,children:[(0,c.jsx)(F,{id:"card-number-element",className:R.default.cardElement,options:{style:{base:{fontSize:"16px",color:"#1f2933","::placeholder":{color:"#9aa5b1"}},invalid:{color:"#d64545"}},showIcon:!0},onChange:a=>{a.brand&&t(a.brand),p(a.error?.message??"")}}),s&&(0,c.jsx)("span",{className:R.default.cardBrand,children:s})]})]}),(0,c.jsxs)("div",{className:R.default.cardDetailsGrid,children:[(0,c.jsxs)("div",{className:R.default.cardFieldWrapper,children:[(0,c.jsx)("label",{htmlFor:"card-expiry-element",className:R.default.cardLabel,children:"Expiration"}),(0,c.jsx)("div",{className:R.default.cardElementContainer,children:(0,c.jsx)(G,{id:"card-expiry-element",className:R.default.cardElement,options:{style:{base:{fontSize:"16px",color:"#1f2933","::placeholder":{color:"#9aa5b1"}},invalid:{color:"#d64545"}}},onChange:a=>p(a.error?.message??"")})})]}),(0,c.jsxs)("div",{className:R.default.cardFieldWrapper,children:[(0,c.jsx)("label",{htmlFor:"card-cvc-element",className:R.default.cardLabel,children:"CVC"}),(0,c.jsx)("div",{className:R.default.cardElementContainer,children:(0,c.jsx)(H,{id:"card-cvc-element",className:R.default.cardElement,options:{style:{base:{fontSize:"16px",color:"#1f2933","::placeholder":{color:"#9aa5b1"}},invalid:{color:"#d64545"}}},onChange:a=>p(a.error?.message??"")})})]})]}),(0,c.jsx)("button",{type:"submit",className:R.default.submitButton,disabled:m||u||!h||!i,children:m?"Processingâ€¦":`Pay ${U(b)}`}),(0,c.jsx)("button",{type:"button",className:R.default.secondaryButton,onClick:f,disabled:m,children:"Choose another method"}),o&&(0,c.jsx)("div",{className:R.default.errorMessage,children:o}),q&&(0,c.jsx)("div",{className:R.default.successMessage,children:q})]}),(0,c.jsxs)("div",{className:R.default.supportBox,children:[(0,c.jsx)("p",{children:"Need help? Contact our support team at"}),(0,c.jsx)("a",{href:"mailto:support@fooddelivery.local",children:"support@fooddelivery.local"})]})]})};function _(){return(0,c.jsx)(y,{stripe:S,children:(0,c.jsx)(W,{stripeEnabled:!!S})})}}];

//# sourceMappingURL=src_app_a5a8ba60._.js.map